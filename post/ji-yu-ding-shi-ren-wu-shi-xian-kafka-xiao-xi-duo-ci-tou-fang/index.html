<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>åŸºäºå®šæ—¶ä»»åŠ¡å®ç° Kafka æ¶ˆæ¯å¤šæ¬¡æŠ•æ”¾ | Asynn</title>
<link rel="shortcut icon" href="https://asynchronemind.github.io/favicon.ico?v=1722239062648">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://asynchronemind.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="åŸºäºå®šæ—¶ä»»åŠ¡å®ç° Kafka æ¶ˆæ¯å¤šæ¬¡æŠ•æ”¾ | Asynn - Atom Feed" href="https://asynchronemind.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="éœ€æ±‚æè¿°
å‰é¢æåˆ°ä¸ä¸‹æ¸¸é¡¹ç›®è¿›è¡Œå¯¹æ¥æ—¶ï¼Œå…¶ä¸­ä¸€ç±»å¯¹æ¥é€”å¾„ç”±kafkaæ¥å®ç°ã€‚
éœ€è¦å°†ç”±æœ¬é¡¹ç›®å®ç°å¹¶è®°å½•çš„å¤šç±»ä¿¡æ¯æŠ•æ”¾è‡³kafkaçš„åŒä¸€Topic: XXX_LOG_TO_PRODUCERä¸‹ã€‚
æµç¨‹å›¾å¦‚ä¸‹ï¼š

æˆ‘ä»¬çŸ¥é“ï¼Œç°æœ‰æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚ï¼šKa..." />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://asynchronemind.github.io">
  <img class="avatar" src="https://asynchronemind.github.io/images/avatar.png?v=1722239062648" alt="">
  </a>
  <h1 class="site-title">
    Asynn
  </h1>
  <p class="site-description">
    ä¹ æƒ¯æ— å¸¸æ‰ä¼šåº†å¹¸ã€‚
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              åŸºäºå®šæ—¶ä»»åŠ¡å®ç° Kafka æ¶ˆæ¯å¤šæ¬¡æŠ•æ”¾
            </h2>
            <div class="post-info">
              <span>
                2024-07-14
              </span>
              <span>
                4 min read
              </span>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content" v-pre>
                <h2 id="éœ€æ±‚æè¿°">éœ€æ±‚æè¿°</h2>
<p>å‰é¢æåˆ°ä¸ä¸‹æ¸¸é¡¹ç›®è¿›è¡Œå¯¹æ¥æ—¶ï¼Œå…¶ä¸­ä¸€ç±»å¯¹æ¥é€”å¾„ç”±<code>kafka</code>æ¥å®ç°ã€‚<br>
éœ€è¦å°†ç”±æœ¬é¡¹ç›®å®ç°å¹¶è®°å½•çš„å¤šç±»ä¿¡æ¯æŠ•æ”¾è‡³<code>kafka</code>çš„åŒä¸€Topic: <code>XXX_LOG_TO_PRODUCER</code>ä¸‹ã€‚<br>
æµç¨‹å›¾å¦‚ä¸‹ï¼š<br>
<img src="https://asynchronemind.github.io/post-images/1720946220284.png" alt="" loading="lazy"><br>
æˆ‘ä»¬çŸ¥é“ï¼Œç°æœ‰æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚ï¼šKafkaã€RocketMQç­‰ï¼Œä¸ºäº†ä¿è¯æ¶ˆæ¯æ¶ˆè´¹çš„é²æ£’æ€§ï¼Œéƒ½å®ç°äº†å„è‡ªçš„é‡å¤æ¶ˆè´¹æœºåˆ¶ã€‚<br>
ä½†æ˜¯ï¼Œ<strong>åœ¨ä¸Šè¿°æµç¨‹å›¾ä¸­å´æ²¡æœ‰ä¸€ä¸ªä¿éšœæ¶ˆæ¯èƒ½å¤Ÿè¢«å®‰å…¨æŠ•æ”¾è‡³<code>Producer</code>çš„æªæ–½ã€‚</strong><br>
è™½ç„¶æˆ‘åœ¨<code>sendToKafka</code>ä¸­ä½¿ç”¨äº†<code>try...catch...</code>æ¥æ•è·å¯èƒ½å‡ºç°çš„å¼‚å¸¸å¹¶è®°å½•åœ¨æ—¥å¿—é‡Œï¼Œä½†è¿™ç§æ–¹æ³•åªèƒ½èµ·ä¸€ä¸ªæé†’ä½œç”¨ï¼Œè¿˜æ˜¯å¾—åœ¨èŠ±è´¹æ—¶é—´æŸ¥çœ‹<strong>é”™è¯¯æ—¥å¿—</strong>çš„æƒ…å†µä¸‹æ‰ç”Ÿæ•ˆï¼Œå¹¶ä¸èƒ½æ»¡è¶³ä¸Šè¿°éœ€æ±‚ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h2>
<p>ç”±äºæœ€è¿‘æ­£å¥½åœ¨çœ‹é¡¹ç›®ä¸­ä½¿ç”¨å®šæ—¶ä»»åŠ¡çš„åœºæ™¯ï¼Œä¾¿æƒ³åˆ°äº†æ˜¯å¦èƒ½å¤šå¢åŠ ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ¥å®ç°æŠ•æ”¾æ¶ˆæ¯ï¼Œä»è€Œè§£å†³æ¶ˆæ¯æŠ•æ”¾å®‰å…¨çš„é—®é¢˜ã€‚<br>
<img src="https://asynchronemind.github.io/post-images/1720948805082.png" alt="" loading="lazy"><br>
è·Ÿmtæ²Ÿé€šäº¤æµäº†ä¸€ä¸‹ä¹‹åï¼Œmtè¡¨ç¤ºè‚¯å®šï¼Œä¾¿æ‰¾äº§å“ç»™æˆ‘æäº†è¿™ä¸ªéœ€æ±‚ğŸ˜²ã€‚<br>
å› ä¸ºå…¬å¸é¡¹ç›®å®šæ—¶ä»»åŠ¡ç»Ÿä¸€ç»„ä»¶ä½¿ç”¨çš„æ˜¯<code>Saturn</code>ï¼Œåœ¨è¿™é‡Œå°±ä¸æ¯”è¾ƒå¸‚é¢ä¸Šç°å­˜çš„å®šæ—¶ä»»åŠ¡å®ç°æ–¹æ¡ˆå­°ä¼˜å­°åŠ£äº†ã€‚</p>
<h3 id="ä»‹ç»ä¸€ä¸‹saturn">ä»‹ç»ä¸€ä¸‹<code>Saturn</code>ï¼š</h3>
<figure data-type="image" tabindex="1"><img src="https://asynchronemind.github.io/post-images/1722238970302.png" alt="" loading="lazy"></figure>
<ul>
<li>å”¯å“ä¼šè‡ªä¸»ç ”å‘çš„åˆ†å¸ƒå¼çš„å®šæ—¶ä»»åŠ¡è°ƒåº¦å¹³å°ï¼Œç›®çš„æ˜¯å–ä»£ä¼ ç»Ÿçš„Linux Cronã€Spring Batch Jobã€Quartzçš„æ–¹å¼ï¼Œåšåˆ°å…¨åŸŸç»Ÿä¸€é…ç½®ï¼Œç»Ÿä¸€ç›‘æ§ï¼Œä»»åŠ¡é«˜å¯ç”¨ä»¥åŠåˆ†ç‰‡ã€‚</li>
<li>æ”¯æŒåŸºäºæ—¶é—´å’Œäº‹ä»¶è§¦å‘ã€äººå·¥æŒ‡å®šèµ„æºåˆ†é…ç­–ç•¥å’Œè‡ªåŠ¨å¹³è¡¡ç­–ç•¥ç»“åˆã€ä»»åŠ¡å¼€å‘è¯­è¨€ä¸å—é™åˆ¶ã€æ”¯æŒä¸€æœºä¸€åˆ†ç‰‡çš„æœ¬åœ°åŒ–æ¨¡å¼ä»»åŠ¡è°ƒåº¦ã€ä»»åŠ¡æŒ‰åˆ†ç‰‡æ‰§è¡Œã€æ¡†æ¶å’Œä¸šåŠ¡ä»£ç éš”ç¦»ã€åˆ†ç‰‡çš„è°ƒåº¦æŒ‰è´Ÿè½½å‡è¡¡åˆ†å¸ƒã€å¯è§†åŒ–ç®¡ç†ã€æ”¯æŒç§’çº§ä»»åŠ¡è§¦å‘ã€å¯è§†åŒ–ç›‘æ§å’ŒæŠ¥è­¦ã€æ”¯æŒå®¹å™¨åŒ– (Docker) éƒ¨ç½²ã€‚</li>
</ul>
<h3 id="å…·ä½“ä½¿ç”¨">å…·ä½“ä½¿ç”¨ï¼š</h3>
<ol>
<li>æ·»åŠ <code>pom</code>ã€‚</li>
<li>ç»§æ‰¿<code>AbstractSaturnJavaJob</code>ç±»ï¼Œé‡å†™<code>handleJavaJob</code>æ–¹æ³•ã€‚<pre><code class="language-java">@Slf4j
@Component
public class RePushCalllogJob extends AbstractSaturnJavaJob {

    @Override
    public SaturnJobReturn handleJavaJob(String jobName, Integer shardItem, String shardParam, SaturnJobExecutionContext saturnJobExecutionContext) throws InterruptedException {
        long begin = System.currentTimeMillis();
        SaturnJobReturn saturnJobReturn = new SaturnJobReturn();
        log.info(&quot;RePushCalllogJob job start: jobName={}, shardItem={}, shardParam={}, jobParameter={}&quot;, jobName, shardItem, shardParam, saturnJobExecutionContext.getJobParameter().trim());
        try {
            process(shardParam);
            saturnJobReturn.setReturnMsg(&quot;Execute RePushCalllogJob successfully&quot;);
        } catch (Exception e) {
            log.warn(&quot;Execute RePushCalllogJob failed&quot;, e);
            saturnJobReturn.setReturnMsg(&quot;Execute RePushCalllogJob failed&quot;);
            saturnJobReturn.setReturnCode(-1);
        }
        log.info(&quot;RePushCalllogJob job end: duration={}&quot;, System.currentTimeMillis() - begin);
        return saturnJobReturn;
    }
</code></pre>
</li>
<li>å…·ä½“æŠ•æ”¾ä»»åŠ¡å®ç°ã€‚<pre><code class="language-java">private void process(String shardParam) {
    if (StringUtils.isBlank(shardParam)) {
        log.warn(&quot;Shard param is empty&quot;);
        return;
    }
    String[] tempStr = StringUtils.split(shardParam, &quot;#&quot;);
    long start = Long.parseLong(tempStr[1]);
    long end = Long.parseLong(tempStr[2]) + 1;//startå’Œendéƒ½è¦æ‰§è¡Œ
    if (start &gt;= end) {
        log.warn(&quot;ID range is invalid&quot;);
        return;
    }
    for (long offStart = start; offStart &lt; end; offStart = offStart + PAGE_SIZE) {
        long offEnd = Math.min(offStart + PAGE_SIZE, end);

        switch (tempStr[0].toLowerCase()) {
            case &quot;aaa_calllog&quot;:
                processaaaCallLog(offStart, offEnd);
                break;
            case &quot;bbb_calllog&quot;:
                processbbbCallLog(offStart, offEnd);
                break;
            case &quot;ccc_calllog&quot;:
                processcccCallLog(offStart, offEnd);
                break;
            case &quot;dddr_calllog&quot;:
                processdddrCallLog(offStart, offEnd);
                break;
            case &quot;eee_calllog&quot;:
                processeeeCallLog(offStart, offEnd);
                break;
            default:
                log.warn(&quot;Unknown call log&quot;);
                return;
        }
    }
}
</code></pre>
</li>
<li>è®¾ç½®å¼€å¯æ—¶é—´ã€‚</li>
</ol>
<h3 id="åç»­æµç¨‹">åç»­æµç¨‹ï¼š</h3>
<ol>
<li>å¯ä»¥å‘ç°æˆ‘ä»¬åªæ˜¯å®ç°æ ¹æ®æ•°æ®èŒƒå›´è¿›è¡Œæ‰¹é‡æŠ•æ”¾ï¼Œå¯èƒ½ä¼šå­˜åœ¨ä¸‹æ¸¸ä»»åŠ¡é‡å¤æ¶ˆè´¹çš„é—®é¢˜ï¼Œéœ€è¦ä¸ä¸‹æ¸¸è¿›è¡Œæ‹‰é€šï¼Œè®©ä»–ä»¬åŠ ä¸Šä¸€ä¸ª<strong>å¹‚ç­‰</strong>é€»è¾‘ï¼Œ<strong>é˜²æ­¢æ¶ˆæ¯é‡å¤æ¶ˆè´¹</strong>ã€‚</li>
</ol>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E9%9C%80%E6%B1%82%E6%8F%8F%E8%BF%B0">éœ€æ±‚æè¿°</a></li>
<li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">è§£å†³æ–¹æ¡ˆ</a>
<ul>
<li><a href="#%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8Bsaturn">ä»‹ç»ä¸€ä¸‹<code>Saturn</code>ï¼š</a></li>
<li><a href="#%E5%85%B7%E4%BD%93%E4%BD%BF%E7%94%A8">å…·ä½“ä½¿ç”¨ï¼š</a></li>
<li><a href="#%E5%90%8E%E7%BB%AD%E6%B5%81%E7%A8%8B">åç»­æµç¨‹ï¼š</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://asynchronemind.github.io/post/spring-zi-dong-zhu-ru-wei-null-de-wen-ti-pai-cha/">
              <h3 class="post-title">
                Spring è‡ªåŠ¨æ³¨å…¥ä¸º null çš„é—®é¢˜æ’æŸ¥
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  <a href="https://github.com/AsynchroneMind">Asynn</a> 
  <a class="rss" href="https://asynchronemind.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
